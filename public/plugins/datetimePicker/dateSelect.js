/*
 * @插件名 dateSelect
 * @作者 小白
 * @日期 2015-06-27
 * @Version 1.0
 * */$.fn.dateSelect=function(w){function n(){var a=B(c,f),g=(new Date(f+"/"+c+"/01")).getDay();$("#datepicker_"+b+" .day li").remove();for(var q=1;q<=a;q++){var d="";f==r&&c==x&&l==q&&(d="active");$("#datepicker_"+b+" .day ul").append("\x3cli data-id\x3d"+q+" class\x3d'"+d+"'\x3e"+q+"\x3c/li\x3e")}$("#datepicker_"+b+" .day li").first().css({"margin-left":30*g})}function B(a,b){switch(a){case 1:return 31;case 2:return 0==b%4?29:28;case 3:return 31;case 4:return 30;case 5:return 31;case 6:return 30;case 7:return 31;case 8:return 31;case 9:return 30;case 10:return 31;case 11:return 30;case 12:return 31}}function A(){$("#ylist_"+b).slideUp("fast");$("#ylist_"+b).prev("span").removeClass("active");$("#mlist_"+b).slideUp("fast");$("#mlist_"+b).prev("span").removeClass("active")}function y(a){if(""==a)return new Date;try{return new Date(a)}catch(g){return new Date}}function z(a){var b=navigator.userAgent.toLowerCase();b.indexOf("opera");b.indexOf("msie");a=document.getElementById(a);if(null===a.parentNode||"none"==a.style.display)return!1;var c,d;if(a.getBoundingClientRect)return b=a.getBoundingClientRect(),{x:b.left+Math.max(document.documentElement.scrollLeft,document.body.scrollLeft),y:b.top+Math.max(document.documentElement.scrollTop,document.body.scrollTop)};if(document.getBoxObjectFor)b=document.getBoxObjectFor(a),c=a.style.borderLeftWidth?parseInt(a.style.borderLeftWidth):0,d=a.style.borderTopWidth?parseInt(a.style.borderTopWidth):0,d=[b.x-c,b.y-d];else{d=[a.offsetLeft,a.offsetTop];c=a.offsetParent;if(c!=a)for(;c;)d[0]+=c.offsetLeft,d[1]+=c.offsetTop,c=c.offsetParent;if(-1!=b.indexOf("opera")||-1!=b.indexOf("safari")&&"absolute"==a.style.position)d[0]-=document.body.offsetLeft,d[1]-=document.body.offsetTop}for(c=a.parentNode?a.parentNode:null;c&&"BODY"!=c.tagName&&"HTML"!=c.tagName;)d[0]-=c.scrollLeft,d[1]-=c.scrollTop,c=c.parentNode?c.parentNode:null;return{x:d[0],y:d[1]}}var m=$.extend({},{offTop:40,format:"yyyy-MM-dd"},w),h=this,b=$(h).attr("id"),t=!1,k=!1,u=z(b);w=u.y;var u=u.x,f,c,l,e,p,r,x,v;$("\x3cdiv class\x3d'tz-datepicker' id\x3d'datepicker_"+b+"'\x3e\x3cdiv class\x3d'year-month' id\x3d'ym"+b+"'\x3e\x3cspan class\x3d'left'\x3e\x3c\x3c/span\x3e\x3cspan class\x3d'month'\x3e\x3cspan\x3e6\u6708\x3c/span\x3e\x3cdiv class\x3d'month-list' id\x3d'mlist_"+b+"'\x3e\x3cul\x3e\x3cli data-id\x3d'1'\x3e\u4e00\u6708\x3c/li\x3e\x3cli data-id\x3d'2'\x3e\u4e8c\u6708\x3c/li\x3e\x3cli data-id\x3d'3'\x3e\u4e09\u6708\x3c/li\x3e\x3cli data-id\x3d'4'\x3e\u56db\u6708\x3c/li\x3e\x3cli data-id\x3d'5'\x3e\u4e94\u6708\x3c/li\x3e\x3cli data-id\x3d'6'\x3e\u516d\u6708\x3c/li\x3e\x3cli data-id\x3d'7'\x3e\u4e03\u6708\x3c/li\x3e\x3cli data-id\x3d'8'\x3e\u516b\u6708\x3c/li\x3e\x3cli data-id\x3d'9'\x3e\u4e5d\u6708\x3c/li\x3e\x3cli data-id\x3d'10'\x3e\u5341\u6708\x3c/li\x3e\x3cli data-id\x3d'11'\x3e\u5341\u4e00\x3c/li\x3e\x3cli data-id\x3d'12'\x3e\u5341\u4e8c\x3c/li\x3e\x3c/ul\x3e\x3c/div\x3e\x3c/span\x3e\x3cspan class\x3d'year'\x3e\x3cspan class\x3d'span-year'\x3e2015\x3c/span\x3e\x3cdiv class\x3d'year-list' id\x3d'ylist_"+b+"'\x3e\x3cul\x3e\x3c/ul\x3e\x3cdiv class\x3d'year-change'\x3e\x3cspan class\x3d'year-left'\x3e\x3c/span\x3e\x3cspan class\x3d'year-right'\x3e\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e\x3c/span\x3e\x3cspan class\x3d'right'\x3e\x3e\x3c/span\x3e\x3c/div\x3e\x3cdiv class\x3d'week'\x3e\x3cul\x3e\x3cli\x3e\u65e5\x3c/li\x3e\x3cli\x3e\u4e00\x3c/li\x3e\x3cli\x3e\u4e8c\x3c/li\x3e\x3cli\x3e\u4e09\x3c/li\x3e\x3cli\x3e\u56db\x3c/li\x3e\x3cli\x3e\u4e94\x3c/li\x3e\x3cli\x3e\u516d\x3c/li\x3e\x3c/ul\x3e\x3c/div\x3e\x3cdiv class\x3d'day'\x3e\x3cul\x3e\x3c/ul\x3e\x3c/div\x3e\x3cdiv class\x3d'action'\x3e\x3cspan\x3e\u6e05\u7a7a\u65e5\u671f\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e").appendTo("body");$("#datepicker_"+b).css({left:u,top:w+m.offTop});$(h).next("span").click(function(){var a=z(b),g=a.y,a=a.x;$("#datepicker_"+b).css({left:a,top:g+m.offTop});a=y($(h).val());c=a.getMonth()+1;f=a.getFullYear();l=a.getDate();x=a.getMonth()+1;r=a.getFullYear();a.getDate();$("#mlist_"+b).prev("span").text(c+"\u6708");$("#ylist_"+b).prev("span").text(f);n();A();k?$("#datepicker_"+b).slideUp("noraml",function(){k=!1;$(".content").css({height:""})}):$("#datepicker_"+b).slideDown("noraml",function(){k=!0;v=$(".content").height();g+m.offTop+234-61-60>v&&$(".content").css({height:g+m.offTop+234-61+10})});a=y($(h).val());$(h).focus();$(this).addClass("span-ex").removeClass("span-col");t=!0});$(h).click(function(){var a=z(b),g=a.y,a=a.x;$("#datepicker_"+b).css({left:a,top:g+m.offTop});a=y($(this).val());c=a.getMonth()+1;f=a.getFullYear();l=a.getDate();x=a.getMonth()+1;r=a.getFullYear();a.getDate();$("#mlist_"+b).prev("span").text(c+"\u6708");$("#ylist_"+b).prev("span").text(f);n();A();k?$("#datepicker_"+b).slideUp("noraml",function(){k=!1;$(".content").css({height:""})}):$("#datepicker_"+b).slideDown("noraml",function(){k=!0;v=$(".content").height();g+m.offTop+234-61-60>v&&$(".content").css({height:g+m.offTop+234-61+10})});t=!0});$(h).blur(function(){$(h).next("span").addClass("span-col").removeClass("span-ex")});$("#datepicker_"+b).on("click",".month span",function(){$(this).addClass("active");$(this).next(".month-list").slideToggle("normal");$("#ylist_"+b).slideUp("fast");$("#ylist_"+b).prev("span").removeClass("active")});$("#datepicker_"+b).on("click",".month li",function(){c=parseInt($(this).attr("data-id"));$("#datepicker_"+b).find(".month span").text(c+"\u6708");n();$(this).addClass("active").siblings("li").removeClass("active");$(this).parents(".month-list").slideUp("fast");$(this).parents(".month-list").prev("span").removeClass("active")});$("#datepicker_"+b).on("click",".year .span-year",function(){var a=$(this).text();e=parseInt(a.substring(0,3)+"0");p=e+9;$("#datepicker_"+b+" .year-list li").remove();for(e;e<=p;e++){var c="";parseInt(a)==e?c="active":c="";$("#datepicker_"+b+" .year-list ul").append("\x3cli class\x3d'"+c+"'\x3e"+e+"\x3c/li\x3e")}$(this).addClass("active");$(this).next(".year-list").slideToggle("normal");$("#mlist_"+b).slideUp("fast");$("#mlist_"+b).prev("span").removeClass("active")});$("#datepicker_"+b).on("click",".year li",function(){f=parseInt($(this).text());$(this).parents(".year-list").prev("span").text(f);n();$(this).addClass("active").siblings("li").removeClass("active");$(this).parents(".year-list").slideUp("fast");$(this).parents(".year-list").prev("span").removeClass("active")});$("#datepicker_"+b).on("click",".year-change span",function(){if($(this).hasClass("year-left"))e=p-19;else if($(this).hasClass("year-right"))e=p+1;else return;p=e+9;$("#datepicker_"+b+" .year-list li").remove();for(e;e<=p;e++){var a="";r==e?a="active":a="";$("#datepicker_"+b+" .year-list ul").append("\x3cli class\x3d'"+a+"'\x3e"+e+"\x3c/li\x3e")}});$("#datepicker_"+b+" .day").on("click","li",function(){l=parseInt($(this).attr("data-id"));var a,e;10>c?a="0"+c:a=c;10>l?e="0"+l:e=l;a=f+"-"+a+"-"+e;$(h).val(a);$(this).parents("#datepicker_"+b).slideUp("noraml",function(){k=!1;$(".content").css({height:""})})});$("#datepicker_"+b+" .left").click(function(){c=parseInt(c);c--;0==c&&(c=12,f--);$("#datepicker_"+b+" .month span").text(c+"\u6708");$("#datepicker_"+b+" .year .span-year").text(f);n()});$("#datepicker_"+b+" .right").click(function(){c=parseInt(c);c+=1;13==c&&(c=1,f++);$("#datepicker_"+b+" .month span").text(c+"\u6708");$("#datepicker_"+b+" .year .span-year").text(f);n()});$("#datepicker_"+b).on("click",".action span",function(){$(h).val("");$("#datepicker_"+b).slideUp("normal")});$(document).bind("click",function(a){a=a||window.event;a=a.srcElement||a.target;a.id!="datepicker_"+b&&$(a).parent()[0].id!="datepicker_"+b&&$(a).parent().parent()[0].id!="datepicker_"+b&&a.id!="ym"+b&&$(a).parent()[0].id!="ym"+b&&$(a).parent().parent()[0].id!="ym"+b&&a.id!="mlist_"+b&&$(a).parent()[0].id!="mlist_"+b&&$(a).parent().parent()[0].id!="mlist_"+b&&a.id!="ylist_"+b&&$(a).parent()[0].id!="ylist_"+b&&$(a).parent().parent()[0].id!="ylist_"+b&&(t?t=!1:$("#datepicker_"+b).slideUp("normal",function(){k=!1;$(".content").css({height:""})}))})};