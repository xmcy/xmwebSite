/*!
 * CityPicker v1.1.0
 * https://github.com/tshi0912/citypicker
 *
 * Copyright (c) 2015-2016 Tao Shi
 * Released under the MIT license
 *
 * Date: 2016-09-09T12:11:57.119Z
 */(function(b){"function"===typeof define&&define.amd?define(["jquery","ChineseDistricts"],b):"object"===typeof exports?b(require("jquery"),require("ChineseDistricts")):b(jQuery,ChineseDistricts)})(function(b,l){function f(a,c){this.$element=b(a);this.$dropdown=null;this.options=b.extend({},f.DEFAULTS,b.isPlainObject(c)&&c);this.active=!1;this.dems=[];this.needBlur=!1;this.init()}if("undefined"===typeof l)throw Error('The file "city-picker.data.js" must be included first!');f.prototype={constructor:f,init:function(){this.defineDems();this.render();this.bind();this.active=!0},render:function(){var a=this.getPosition(),c=this.$element.attr("placeholder")||this.options.placeholder,c='\x3cspan class\x3d"city-picker-span" style\x3d"'+this.getWidthStyle(a.width)+"height:"+a.height+"px;line-height:"+(a.height-1)+'px;"\x3e'+(c?'\x3cspan class\x3d"placeholder"\x3e'+c+"\x3c/span\x3e":"")+'\x3cspan class\x3d"title"\x3e\x3c/span\x3e\x3cdiv class\x3d"arrow"\x3e\x3c/div\x3e\x3c/span\x3e',a='\x3cdiv class\x3d"city-picker-dropdown" style\x3d"left:0px;top:100%;'+this.getWidthStyle(a.width,!0)+'"\x3e\x3cdiv class\x3d"city-select-wrap"\x3e\x3cdiv class\x3d"city-select-tab"\x3e\x3ca class\x3d"active" data-count\x3d"province"\x3e\u7701\u4efd\x3c/a\x3e'+(this.includeDem("city")?'\x3ca data-count\x3d"city"\x3e\u57ce\u5e02\x3c/a\x3e':"")+(this.includeDem("district")?'\x3ca data-count\x3d"district"\x3e\u533a\u53bf\x3c/a\x3e':"")+'\x3c/div\x3e\x3cdiv class\x3d"city-select-content"\x3e\x3cdiv class\x3d"city-select province" data-count\x3d"province"\x3e\x3c/div\x3e'+(this.includeDem("city")?'\x3cdiv class\x3d"city-select city" data-count\x3d"city"\x3e\x3c/div\x3e':"")+(this.includeDem("district")?'\x3cdiv class\x3d"city-select district" data-count\x3d"district"\x3e\x3c/div\x3e':"")+"\x3c/div\x3e\x3c/div\x3e";this.$element.addClass("city-picker-input");this.$textspan=b(c).insertAfter(this.$element);this.$dropdown=b(a).insertAfter(this.$textspan);var d=this.$dropdown.find(".city-select");b.each(this.dems,b.proxy(function(a,c){this["$"+c]=d.filter("."+c+"")},this));this.refresh()},refresh:function(a){this.$dropdown.find(".city-select").data("item",null);var c=this.$element.val()||"",c=c.split("/");b.each(this.dems,b.proxy(function(b,e){c[b]&&b<c.length?this.options[e]=c[b]:a&&(this.options[e]="");this.output(e)},this));this.tab("province");this.feedText();this.feedVal()},defineDems:function(){var a=!1;b.each(["province","city","district"],b.proxy(function(c,b){a||this.dems.push(b);b===this.options.level&&(a=!0)},this))},includeDem:function(a){return-1!==b.inArray(a,this.dems)},getPosition:function(){var a,c,b,e;a=this.$element.position();b=this.getSize(this.$element);c=b.height;b=b.width;this.options.responsive&&(e=this.$element.offsetParent().width())&&(b/=e,.99<b&&(b=1),b=100*b+"%");return{top:a.top||0,left:a.left||0,height:c,width:b}},getSize:function(a){var c;a.is(":visible")?a={width:a.outerWidth(),height:a.outerHeight()}:(c=b("\x3cdiv /\x3e").appendTo(b("body")),c.css({position:"absolute !important",visibility:"hidden !important",display:"block !important"}),a=a.clone().appendTo(c),a={width:a.outerWidth(),height:a.outerHeight()},c.remove());return a},getWidthStyle:function(a,c){return this.options.responsive&&!b.isNumeric(a)?"width:"+a+";":"width:"+(c?Math.max(320,a):a)+"px;"},bind:function(){var a=this;b(document).on("click",this._mouteclick=function(c){c=b(c.target);var d,e,g;c.is(".city-picker-span")?e=c:c.is(".city-picker-span *")&&(e=c.parents(".city-picker-span"));c.is(".city-picker-input")&&(g=c);c.is(".city-picker-dropdown")?d=c:c.is(".city-picker-dropdown *")&&(d=c.parents(".city-picker-dropdown"));(!g&&!e&&!d||e&&e.get(0)!==a.$textspan.get(0)||g&&g.get(0)!==a.$element.get(0)||d&&d.get(0)!==a.$dropdown.get(0))&&a.close(!0)});this.$element.on("change",this._changeElement=b.proxy(function(){this.close(!0);this.refresh(!0)},this)).on("focus",this._focusElement=b.proxy(function(){this.needBlur=!0;this.open()},this)).on("blur",this._blurElement=b.proxy(function(){this.needBlur&&(this.needBlur=!1,this.close(!0))},this));this.$textspan.on("click",function(c){var d=b(c.target);c.stopPropagation();a.needBlur=!1;d.is(".select-item")?(c=d.data("count"),a.open(c)):a.$dropdown.is(":visible")?a.close():a.open()}).on("mousedown",function(){a.needBlur=!1});this.$dropdown.on("click",".city-select a",function(){var c=b(this).parents(".city-select"),d=c.find("a.active"),e=0===c.next().length;d.removeClass("active");b(this).addClass("active");d.data("code")!==b(this).data("code")&&(c.data("item",{address:b(this).attr("title"),code:b(this).data("code")}),b(this).trigger("change.citypicker"),a.feedText(),a.feedVal(!0),e&&a.close())}).on("click",".city-select-tab a",function(){if(!b(this).hasClass("active")){var c=b(this).data("count");a.tab(c)}}).on("mousedown",function(){a.needBlur=!1});if(this.$province)this.$province.on("change.citypicker",this._changeProvince=b.proxy(function(){this.output("city");this.output("district");this.tab("city")},this));if(this.$city)this.$city.on("change.citypicker",this._changeCity=b.proxy(function(){this.output("district");this.tab("district")},this))},open:function(a){a=a||"province";this.$dropdown.show();this.$textspan.addClass("open").addClass("focus");this.tab(a)},close:function(a){this.$dropdown.hide();this.$textspan.removeClass("open");a&&(a=document.createEvent("HTMLEvents"),a.initEvent("listen",!1,!1),this.$textspan.removeClass("focus"),document.dispatchEvent(a))},unbind:function(){b(document).off("click",this._mouteclick);this.$element.off("change",this._changeElement);this.$element.off("focus",this._focusElement);this.$element.off("blur",this._blurElement);this.$textspan.off("click");this.$textspan.off("mousedown");this.$dropdown.off("click");this.$dropdown.off("mousedown");this.$province&&this.$province.off("change.citypicker",this._changeProvince);this.$city&&this.$city.off("change.citypicker",this._changeCity)},getText:function(){var a="";this.$dropdown.find(".city-select").each(function(){var c=b(this).data("item"),d=b(this).data("count");c&&(a+=(b(this).hasClass("province")?"":"/")+'\x3cspan class\x3d"select-item" data-count\x3d"'+d+'" data-code\x3d"'+c.code+'"\x3e'+c.address+"\x3c/span\x3e")});return a},getPlaceHolder:function(){return this.$element.attr("placeholder")||this.options.placeholder},feedText:function(){this.getText()?(this.$textspan.find("\x3e.placeholder").hide(),this.$textspan.find("\x3e.title").html(this.getText()).show()):(this.$textspan.find("\x3e.placeholder").text(this.getPlaceHolder()).show(),this.$textspan.find("\x3e.title").html("").hide())},getCode:function(a){var c={},d=[];this.$textspan.find(".select-item").each(function(){var a=b(this).data("code"),g=b(this).data("count");c[g]=a;d.push(a)});return a?c[a]:d.join("/")},getVal:function(){var a="";this.$dropdown.find(".city-select").each(function(){var c=b(this).data("item");c&&(a+=(b(this).hasClass("province")?"":"/")+c.address)});return window.finalText=a},feedVal:function(a){this.$element.val(this.getVal());a&&this.$element.trigger("cp:updated")},output:function(a){var c=this.options,d=this["$"+a],e="province"===a?{}:[],g,f,k=null,h;d&&d.length&&(h=((g=d.data("item"))?g.address:null)||c[a],f="province"===a?86:"city"===a?this.$province&&this.$province.find(".active").data("code"):"district"===a?this.$city&&this.$city.find(".active").data("code"):f,c=b.isNumeric(f)?l[f]:null,b.isPlainObject(c)&&b.each(c,function(b,c){var d;if("province"===a){d=[];for(var f=0;f<c.length;f++)c[f].address===h&&(k={code:c[f].code,address:c[f].address}),d.push({code:c[f].code,address:c[f].address,selected:c[f].address===h});e[b]=d}else c===h&&(k={code:b,address:c}),e.push({code:b,address:c,selected:c===h})}),d.html("province"===a?this.getProvinceList(e):this.getList(e,a)),d.data("item",k))},getProvinceList:function(a){var c=[],d=this,e=this.options.simple;b.each(a,function(a,f){c.push('\x3cdl class\x3d"clearfix"\x3e');c.push("\x3cdt\x3e"+a+"\x3c/dt\x3e\x3cdd\x3e");b.each(f,function(a,b){c.push('\x3ca title\x3d"'+(b.address||"")+'" data-code\x3d"'+(b.code||"")+'" class\x3d"'+(b.selected?" active":"")+'"\x3e'+(e?d.simplize(b.address,"province"):b.address)+"\x3c/a\x3e")});c.push("\x3c/dd\x3e\x3c/dl\x3e")});return c.join("")},getList:function(a,c){var d=[],e=this,f=this.options.simple;d.push('\x3cdl class\x3d"clearfix"\x3e\x3cdd\x3e');b.each(a,function(a,b){d.push('\x3ca title\x3d"'+(b.address||"")+'" data-code\x3d"'+(b.code||"")+'" class\x3d"'+(b.selected?" active":"")+'"\x3e'+(f?e.simplize(b.address,c):b.address)+"\x3c/a\x3e")});d.push("\x3c/dd\x3e\x3c/dl\x3e");return d.join("")},simplize:function(a,b){return a},tab:function(a){var b=this.$dropdown.find(".city-select"),d=this.$dropdown.find(".city-select-tab \x3e a"),e=this["$"+a];a=this.$dropdown.find('.city-select-tab \x3e a[data-count\x3d"'+a+'"]');e&&(b.hide(),e.show(),d.removeClass("active"),a.addClass("active"))},reset:function(){this.$element.val(null).trigger("change")},destroy:function(){this.unbind();this.$element.removeData("citypicker").removeClass("city-picker-input");this.$textspan.remove();this.$dropdown.remove()}};f.DEFAULTS={simple:!1,responsive:!1,placeholder:"\u8bf7\u9009\u62e9\u7701/\u5e02/\u533a",level:"district",province:"",city:"",district:""};f.setDefaults=function(a){b.extend(f.DEFAULTS,a)};f.other=b.fn.citypicker;b.fn.citypicker=function(a){var c=[].slice.call(arguments,1);return this.each(function(){var d=b(this),e=d.data("citypicker"),g;if(!e){if(/destroy/.test(a))return;e=b.extend({},d.data(),b.isPlainObject(a)&&a);d.data("citypicker",e=new f(this,e))}"string"===typeof a&&b.isFunction(g=e[a])&&g.apply(e,c)})};b.fn.citypicker.Constructor=f;b.fn.citypicker.setDefaults=f.setDefaults;b.fn.citypicker.noConflict=function(){b.fn.citypicker=f.other;return this};b(function(){b('[data-toggle\x3d"city-picker"]').citypicker()})});