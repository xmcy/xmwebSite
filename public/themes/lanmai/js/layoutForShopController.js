!function(t,e){var n=t.module("layoutForshop");n.filter("myfilter",function(){return function(t){return t?"显示中":"已关闭"}}),n.filter("defilter",function(){return function(t){return t?"开":"关"}}),n.filter("timeFilter",function(){return function(t){return t.split("T")[0]}}),n.filter("valToType",[function(){return function(t){return"Manufacture"==t?"广告制作":"Material"==t?"广告材料":"Equipment"==t?"广告设备":void 0}}]),n.controller("layoutForshopController",["$scope","$window",function(t,e){var n=e.location.href.split("/");t.activeSlidebar=n[n.length-1]}]),n.filter("toD",function(){return function(t){var e;return"Manufacture"==t?e="dMake":"Material"==t?e="dmaterial":"Equipment"==t&&(e="dMachine"),e}}),n.controller("shopcertificationController",["$scope","$http","$window",function(t,e,n){}]),n.controller("shoptenderController",["$scope","$http","$window",function(t,e,n){t.downpayment=function(t){swal({title:"请选择支付方式",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"微信",cancelButtonText:"支付宝",cancelButtonColor:"#AEDEF4",closeOnConfirm:!1,closeOnCancel:!1,html:!0},function(e){var r="";r=e?"微信":"支付宝",swal({title:'<img src="/tender/payTenderBill?tenderId='+t._id+"&payType="+r+'支付&status=3">',text:"请打开"+r+"扫码支付",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"支付完成",cancelButtonText:"支付遇到问题",closeOnConfirm:!1,closeOnCancel:!1,html:!0},function(t){t?(swal.close(),o()):swal({title:"<h1>即将为您联系在线客服</h1>",showCancelButton:!0,confirmButtonColor:"#DD6B55",cancelButtonText:"取消",confirmButtonText:"联系客服",closeOnConfirm:!1,closeOnCancel:!1,html:!0},function(t){t?n.location.href="/users/helperCenter#5":swal.close()})})})},t.finalpayment=function(t){swal({title:"请选择支付方式",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"微信",cancelButtonText:"支付宝",cancelButtonColor:"#AEDEF4",closeOnConfirm:!1,closeOnCancel:!1,html:!0},function(e){var r="";r=e?"微信":"支付宝",swal({title:'<img src="/tender/payTenderBill?tenderId='+t._id+"&payType="+r+'支付&status=5">',text:"请打开"+r+"扫码支付",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"支付完成",cancelButtonText:"支付遇到问题",closeOnConfirm:!1,closeOnCancel:!1,html:!0},function(t){t?(swal.close(),o()):swal({title:"<h1>即将为您联系在线客服</h1>",showCancelButton:!0,confirmButtonColor:"#DD6B55",cancelButtonText:"取消",confirmButtonText:"联系客服",closeOnConfirm:!1,closeOnCancel:!1,html:!0},function(t){t?n.location.href="/users/helperCenter#5":swal.close()})})})},t.tocheck=function(n){t.button_clicked=!0,e.post("/tender/tenderConform",{tenderId:n._id}).success(function(e){"success"==e.result&&(swal({title:"确认验收成功!",type:"success",confirmButtonText:"确定"}),o()),t.button_clicked=!1})};var o=function(){t.messageFor="",t.dataList=[],e.post("/tender/searchTenderByStatus",{resType:t.border,page:t.bigCurrentPage,limit:t.itemsPerPage}).success(function(e){e.docs?(t.dataList=e.docs,t.bigTotalItems=e.pageInfo.totalItems):(t.dataList=[],t.bigTotalItems=0,t.messageFor="您暂未发布资源")})};t.readcomment=function(t){n.open("../users/shopcomment?id="+t.chosenBidderUser)},t.cancle=function(o){t.button_clicked=!0,e.post("/tender/canCancelMyTender",{tenderId:o._id}).success(function(r){"您可以无责任取消此次招标"==r.result?swal({title:"确定取消此次招标?",text:"您可以无责任取消此次招标！",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"确定取消",cancelButtonText:"放弃取消",closeOnConfirm:!1},function(){e.post("/tender/cancelMyTender",{tenderId:o._id}).success(function(t){"success"==t.result?(swal("取消成功!"),n.location.reload()):swal(t.result)})}):"取消此次招标您将产生违约记录，每个自然月违规3次后，当月您将不能发布新的招标"==r.result?swal({title:"确定取消此次招标?",text:"取消此次招标您将产生违约记录，每个自然月违规3次后，当月您将不能发布新的招标！",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"确定取消",cancelButtonText:"放弃取消",closeOnConfirm:!1},function(){e.post("/tender/cancelMyTender",{tenderId:o._id}).success(function(t){"success"==t.result?swal("取消成功!"):swal(t.result)})}):swal(r.error),t.button_clicked=!1})},t.collect=function(e){t.border=e,t.index=-1,o()},t.border="招标中",t.pageChanged=function(e){t.index=-1,o()},t.tocomment=function(n){t.forcommentShow=!0,e.post("/tender/queryMyBidsByOne",{tenderId:n._id}).success(function(e){e.tenderNum&&(t.tenderNum=e.tenderNum,t.tenderId=e._id,t.timeRcdStep5=e.timeRcdStep5,t.title=e.title,t.data=e,t.categoryL1=e.categoryL1.name,t.categoryL2=e.categoryL2.name),console.log(e)})},t.closeModel=function(){t.forcommentShow=!1},t.subbmitCheck=function(){t.button_clicked=!0;var n={type:"1",tenderId:t.tenderId,quality:t.point1,describe:t.point2,attitude:t.point3,speed:t.point4,details:t.comments,anonymous:t.anonymous,images:t.imgArr};e.post("/tender/tenderJudgement",n).success(function(e){"success"==e.result?(t.forcommentShow=!1,swal({title:"评价成功!",type:"success",confirmButtonText:"确定"}),o()):e.error?swal({title:e.error,type:"error",confirmButtonText:"确定"}):swal({title:"评价失败！",type:"error",confirmButtonText:"确定"}),t.button_clicked=!1})},t.complain=function(n){e.post("/tender/searchTenderByBid",{id:n._id}).success(function(e){e.docs?(t.complainCompanyName=e.bidCompany.companyName,t.complainTenderNum=e.docs.tenderNum,t.complainTenderName=e.docs.title,t.complainCatelogory1=e.docs.categoryL1.name,t.complainCatelogory2=e.docs.categoryL2.name,t.forcomplainShow=!t.forcomplainShow,t.item=e):console.log(e)})},t.confirmComplain=function(){t.button_clicked=!0,t.complainDetails.trim().length>0&&t.complainDetails.trim().length<350?swal({title:"确定提交投诉?",text:"投诉提交后对方将收到提醒，一经平台核实，将对对方采取相应惩戒措施！",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"确定投诉",cancelButtonText:"放弃投诉",closeOnConfirm:!1},function(){e.post("/tender/insertComplain",{tenderId:t.item.docs._id,type:1,targetUser:t.item.docs.chosenBidderUser,targetCompany:t.item.docs.chosenBidder.company,company:t.item.docs.company._id,details:t.complainDetails}).success(function(e){"success"==e.result?(swal("投诉成功!","收到投诉后客服会第一时间联系您,请保持手机通畅."),t.forcomplainShow=!1,o()):"投标方已投诉，投诉正在解决当中"==e.error&&(swal("投标方已投诉，投诉正在解决中"),t.forcomplainShow=!1),t.button_clicked=!1})}):swal({title:"评价字数不能超过350字且不能为空！",type:"error",confirmButtonText:"确定"})},t.maxSize=5,t.itemsPerPage=5,t.bigCurrentPage=1,t.index=-1,t.forcommentShow=!1,t.forcomplainShow=!1,t.tenderNum="",t.tenderId="",t.point1="5",t.point2="5",t.point3="5",t.point4="5",t.comments="",t.anonymous=!1,t.imgArr=[],t.item={},t.button_clicked=!1,o()}]),n.controller("shopbidController",["$scope","$http","$window",function(t,n,o){var r=function(){t.messageFor="",t.dataList=[],n.post("/tender/queryMyBids",{type:t.border,page:t.bigCurrentPage,limit:t.itemsPerPage}).success(function(e){e.docs?(t.dataList=e.docs,t.bigTotalItems=e.pageInfo.totalItems,t.userId=e.id,console.log(e.docs)):(t.dataList=[],t.bigTotalItems=0,t.messageFor="您暂无任何投标记录")})};t.collect=function(e){t.border=e,t.index=-1,r()},t.readcomment=function(t){o.location.href="../users/shopcomment?id="+t.chosenBidderUser},t.border="投标中",t.pageChanged=function(e){t.index=-1,r()},t.confirmComplain=function(){t.button_clicked=!0,t.complainDetails.trim().length>0&&t.complainDetails.trim().length<350?swal({title:"确定提交投诉?",text:"投诉提交后对方将收到提醒，一经平台核实，将对对方采取相应惩戒措施！",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"确定投诉",cancelButtonText:"放弃投诉",closeOnConfirm:!1},function(){n.post("/tender/insertComplain",{tenderId:t.item.docs._id,type:2,targetUser:t.item.docs.user,targetCompany:t.item.docs.company._id,company:t.item.docs.chosenBidder.company,details:t.complainDetails}).success(function(e){"success"==e.result?(swal("投诉成功!","收到投诉后客服会第一时间联系您,请保持手机通畅."),t.forcomplainShow=!1,r()):"招标方已投诉，投诉正在解决当中"==e.error&&(swal("招标方已投诉，投诉正在解决当"),t.forcomplainShow=!1),t.button_clicked=!1})}):swal({title:"评价字数不能超过350字且不能为空！",type:"error",confirmButtonText:"确定"})},t.confirm=function(e){t.button_clicked=!0,n.post("/tender/insertCash",{vnum:t.code,payType:"支付宝",targetId:t.item._id,price:parseInt(t.item.downpayment)+parseInt(t.item.finalpayment),status:2}).success(function(e){e.result?(swal("提交提现成功"),r()):swal(e.error),t.promisetocashShow=!1,t.button_clicked=!1})},t.tocash=function(n){t.item={},t.item=n,e.post("/users/sendVerifyCodeDirect",{phoneNum:e("#phoneNum").val()},function(t){}),t.promisetocashShow=!0},t.tocomment=function(e){t.forcommentShow=!0,n.post("/tender/queryMyBidsByOne",{tenderId:e._id}).success(function(e){e.tenderNum&&(t.tenderNum=e.tenderNum,t.timeRcdStep5=e.timeRcdStep5,t.title=e.title,t.tenderId=e._id,t.data=e,t.categoryL1=e.categoryL1.name,t.categoryL2=e.categoryL2.name),console.log(e)})},t.closeModel=function(){t.forcommentShow=!1},t.close=function(){t.promisetocashShow=!1},t.complain=function(e){n.post("/tender/searchTenderByBid",{id:e._id}).success(function(e){e.docs?(t.complainCompanyName=e.docs.company.companyName,t.complainTenderNum=e.docs.tenderNum,t.complainTenderName=e.docs.title,t.complainCatelogory1=e.docs.categoryL1.name,t.complainCatelogory2=e.docs.categoryL2.name,t.forcomplainShow=!t.forcomplainShow,t.item=e):console.log(e)})},t.maxSize=5,t.itemsPerPage=5,t.bigCurrentPage=1,t.index=-1,t.forcommentShow=!1,t.forcommentShow=!1,t.tenderNum="",t.tenderId="",t.promisetocashShow=!1,t.item={},t.button_clicked=!1,r()}]),n.controller("shopaccountController",["$scope","$http","$window",function(t,e,n){var o=function(){t.messageFor="",e.post("/tender/queryMyTransactions",{page:t.bigCurrentPage,limit:t.itemsPerPage}).success(function(e){e.docs?(t.dataList=e.docs,t.bigTotalItems=e.pageInfo.totalItems,console.log(e)):(t.dataList=[],t.bigTotalItems=0,t.messageFor="您暂未发布资源")})};t.pageChanged=function(t){o()},t.maxSize=5,t.itemsPerPage=5,t.bigCurrentPage=1,o()}]),n.filter("noNull",function(){return function(t){return t||0}}),n.filter("bidprice",function(){return function(t,e){if(!(t.bidders.length>1))return t.bidders[0].price;for(var n=0;n<t.bidders.length;n++)if(t.bidders[n].user==e)return t.bidders[n].price}}),n.filter("tenderstep",function(){return function(t){return t.isCanceled?"已取消":2==t.status?moment(t.tenderEnd).isBefore(new Date)?"选标中":"投标中":3==t.status||4==t.status||5==t.status?"已选标":6==t.status?"已交付":void 0}}),n.filter("tenderstep2",function(){return function(t){if(t.isCanceled);else{if(2==t.status)return moment(t.tenderEnd).isBefore(new Date)?"距离选标剩余":"投标剩余";if(3==t.status)return"距离定金支付剩余";if(4==t.status)return"距离验收剩余";if(5==t.status)return"距离尾款支付";if(6==t.status&&!t.timeRcdStep6)return"距离评价剩余"}}}),n.filter("tenderstep3",function(){return function(t){if(!t.isCanceled){if(2==t.status)if(moment(t.tenderEnd).isBefore(new Date))e=moment(t.tenderEnd).add("days",3).toDate().getTime();else e=moment(t.tenderEnd).toDate().getTime();else if(3==t.status)e=moment(t.timeRcdStep2).add("days",3).toDate().getTime();else if(4==t.status)e=moment(t.serviceEnd).toDate().getTime();else if(5==t.status)e=moment(t.timeRcdStep4).add("days",7).toDate().getTime();else if(6==t.status&&!t.timeRcdStep6)var e=moment(t.timeRcdStep5).add("days",30).toDate().getTime();var n="",o=(e-(new Date).getTime())/1e3,r=parseInt(o/24/3600),i=parseInt(o%86400/3600),c=parseInt(o%3600/60);return r>0&&(n+=r+"天"),i>0&&(n+=i+"小时"),c>0&&(n+=c+"分钟"),n}}}),n.filter("tenderstep4",["$sce",function(t){return function(e){if(e.isCanceled){var n=e.cancelDetail;return t.trustAsHtml("<a class='blueColor' title='"+n+"'>"+n+"</a>")}return 2==e.status?moment(e.tenderEnd).isBefore(new Date)?t.trustAsHtml("<a class='redFont' href='tenderinfo?id="+e._id+"'>去选标</a><a ng-click='cancle(item)' class='blueColor'>取消招标</a>"):t.trustAsHtml("<a ng-click='cancle(item)' class='blueColor'>取消招标</a>"):3==e.status?t.trustAsHtml("<a ng-click='downpayment(item)' class='blueColor'>支付定金</a>"):4==e.status?t.trustAsHtml("<a ng-click='tocheck(item)'  class='blueColor'>确认验收</a>"):5==e.status?t.trustAsHtml("<a ng-click='finalpayment(item)' class='blueColor'>支付尾款</a>"):6==e.status?e.timeRcdStep6?t.trustAsHtml("<a class='blueColor' ng-click='readcomment(item)'>查看评价</a>"):t.trustAsHtml("<a class='blueColor ' ng-click='tocomment(item)'  >去评价</a>"):void 0}}]),n.filter("tenderstep5",["$sce",function(t){return function(e){if(e.isCanceled){var n=e.cancelDetail;return t.trustAsHtml("<a title='"+n+"'>"+n+"</a>")}if(6==e.status)return e.timeRcdStep6?t.trustAsHtml("<a ng-click='readcomment(item)' >查看评价</a>"):t.trustAsHtml("<a>等待招标方评价</a>")}}]),n.filter("tocash",["$sce",function(t){return function(e){if(6==e.status){if(1==e.withdrawDeposit||!e.withdrawDeposit)return t.trustAsHtml("<a class='redFont' ng-click='tocash(item)'>去提现</a>");if(2==e.withdrawDeposit)return t.trustAsHtml("<a class='redFont' >提现中</a>");if(3==e.withdrawDeposit)return t.trustAsHtml("<a class='redFont' >已提现</a>")}}}]),n.filter("deposit",function(){return function(t){return t?"已缴纳"+t+"元招标保证金":"保证金未缴纳"}}),n.filter("endtime",function(){return function(t){var e="",n=(moment(t).toDate().getTime()-(new Date).getTime())/1e3,o=parseInt(n/24/3600),r=parseInt(n%86400/3600),i=parseInt(n%3600/60);return o>0&&(e+=o+"天"),r>0&&(e+=r+"小时"),i>0&&(e+=i+"分钟"),e}}),n.filter("itemToId",function(){return function(t){return t._id}}),n.filter("filetype",function(){return function(t){function e(){for(i=0;i<t.files.length;i++)if("png"==t.files[i].name.split(".")[1]||"jpg"==t.files[i].name.split(".")[1]||"jpeg"==t.files[i].name.split(".")[1]){var e=[];return e.push(i),t.files[e[0]].url}}return e()?e():"/themes/lanmai/images/fileicon.png"}}),n.filter("topfilter",function(){return function(t){return t?"已置顶":"置顶"}}),n.filter("itemToPro",function(){return function(t){return!(!t.promotionRegions||0==t.promotionRegions.length||!t.promotionEnd||t.promotionEnd<=new Date)}})}(angular,jQuery);